<!DOCTYPE html>
<html >
<head>
    <meta charset="UTF-8">
    <title>实时监控画面</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="/assets/layui-v2.0.0/css/layui.css" media="all" />
    <link rel="stylesheet" href="/assets/layui-v2.0.0/font-awesome/css/font-awesome.min.css">

    <link rel="stylesheet" href="/assets/css/base.css" type="text/css" />
    <link rel="stylesheet" href="/assets/css/common/comparePhoto.css" type="text/css" />
    <link rel="stylesheet" href="/assets/css/monitor/monitorRtsp.css" type="text/css" />

    <!--新版实时监控查看功能 @author Junior @Date 2019-5-6-->
	<style type="text/css">
		.visibility {visibility: visible;}
		.visibility-hidden {visibility: hidden;}
	</style>

</head>

<body>
<div class="fullScreen softSz-bg-middleBlack originalWrap">

    <!--div遮挡块，遮挡人脸车辆的超出部分，为了美观设计-->
    <div class="overrideDiv"></div>
    <!--头部-->
    <div class="original-top">

    </div>
    <div class="original-center">
        <div class="center-left">
            <div class="original-titleWrap">

                <div class="statisticsGroup" >
                    <ul class="softSz-horizontal-tree">
                        <li>
                            <div><span><img src="/assets/images/newui/original/human.png" /></span><label style="color: #20aaeb" >人形:<d id="labCount_human">0</d></label></div>
                        </li>
                        <li>
                            <div><span><img src="/assets/images/newui/original/face.png" /></span><label style="color: #216ff0" >人脸:<d id="labCount_face">0</d></label></div>
                        </li>
                        <li>
                            <div><span><img src="/assets/images/newui/original/car.png" /></span><label style="color: #8015e3" >车辆:<d id="labCount_car">0</d></label></div>
                        </li>

                    </ul>
                </div>
            </div>
            <div class="videoWrap">
                <!--style="height:460px;width:877px;"-->
                <div id="camera_video" style="padding:10px;box-sizing:border-box;">
                    <!--[if IE]>
                    <object type='application/x-vlc-plugin' id='vlct' events='True'
                            classid='clsid:9BE31822-FDAD-461B-AD51-BE1D1C159921' codebase="http://downloads.videolan.org/pub/videolan/vlc/latest/win32/axvlc.cab" height="47.5vh" width="45.5vw;">
                        <param name='mrl' value='#(rtsptext??)'/>
                        <param name='volume' value='50' />
                        <param name='autoplay' value='true' />
                        <param name='loop' value='false' />
                        <param name='fullscreen' value='false' />
                    </object>
                    <![endif]-->
                    <!--[if !IE]><!-->
                    <object type='application/x-vlc-plugin' id='vlct' events='True' style="height:47.5vh;width:45.5vw;" pluginspage="http://www.videolan.org" codebase="http://downloads.videolan.org/pub/videolan/vlc-webplugins/2.0.6/npapi-vlc-2.0.6.tar.xz">
                        <param name='mrl' value="#(rtsptext??)" />
                        <param name='volume' value='50' />
                        <param name='autoplay' value='true' />
                        <param name='loop' value='false' />
                        <param name='fullscreen' value='false' />
                    </object>
                    <!--<![endif]-->
                </div>

            </div>
            <div class="carTitle commonTitle"> <label>车辆抓拍</label></div>
        </div>
        <div class="center-right">
       		 <div class="layui-form layui-form-item" style="display:inline-block;position: absolute; top: -4%; right: 6%;">
                <label class="layui-form-label" style="font-size: 16px;padding: 10px;">是否显示小图背景</label>
                <div class="layui-input-block" style="margin-left: 100%;top:4px;">
                    <input type="checkbox" class="switchComparePhoto"  name="close" lay-skin="switch" lay-filter="switchComparePhoto" lay-text="是|否" checked>
                </div>
            </div>
            <div class="center-right-wrap">

                <div class="center-right-top">
                    <div class="humanTitle commonTitle"> <label>人形抓拍</label></div>
                    <div class="humanTitleBottom humanTreeWrap">
                        <ul class="humanTree snapShotList snapShotList2" id="snapShotList">
                            
                            
                           
                        </ul>
                    </div>
                </div>
                <div class="center-right-bottom">
                    <div class="faceTitle commonTitle"> <label>人脸抓拍</label></div>
                    <div class="faceTitleBottom faceTreeWrap">
                        <ul class="faceTree snapShotListFace snapShotList2" id="snapShotListFace">
                             
                            
                       
                        </ul>
                    </div>
                </div>
            </div>

        </div>

    </div>
    <div class="original-bottom">
        <div class="carTreeWrap">
            <ul class="carTree snapShotListCar snapShotList2" id="snapShotListCar">
              
                
        
            </ul>
        </div>
    </div>

</div>
</body>

<script src="#(BASE_PATH??)/assets/js/jquery-3.1.1.min.js"></script>
<script src="#(BASE_PATH??)/assets/js/ws/tio/TioWebsocket.js"></script>


<script>
$(function(){
	// debugger;
    var ivaeId="#(ivaeId??)";
    camareId = "#(camareId??)";
    
    var ip = "#(surveilIp??'')";
   
            
            // 处理 WebSocket
            var  wsPort= "80";
            var  wsHost= "15.45.223.199";
            var ws_protocol = 'ws'; // ws 或 wss
            
			if(ip && ip !=''){
			  var surveilIpArr =ip.split(':');
			  wsHost = surveilIpArr[0];
			  if(surveilIpArr.length>1){
				  wsPort = surveilIpArr[1];
			  }
			}else{
				wsHost = location.hostname;
			}
            var heartbeatTimeout = 5000; // 心跳超时时间，单位：毫秒
            var reconnInterval = 1000; // 重连间隔时间，单位：毫秒

            var binaryType = 'blob'; // 'blob' or 'arraybuffer';//arraybuffer是字节
            var handler = new DemoHandler();//websocket处理引擎
            var queryString = 'deviceId='+ivaeId;//自定义携带参数多个参数类似这样&分隔'type=yourType&deviceId=yourDeviceId'


            var tiows;
         
            initWs();//开启websoket
           
            function initWs () {
          	 try{
                   tiows.close();//先关闭上一次的websocket再连接
                   console.log("TIO---close")
                  
               }catch(e){

               }
               tiows=new TioWebsocket({
                   ws_protocol:ws_protocol,
                   ip:wsHost,
                   port:wsPort,
                   heartbeatTimeout:heartbeatTimeout,
                   reconnInterval:reconnInterval,
                   binaryType:binaryType,
                   handler:handler,
                   paramStr:queryString
               });
               tiows.connect(isReconnect=false);//开始连接，其中isReconnect=false关闭自动重连
               console.log("TIO---new");

              
            }
     
   //websoket引擎
    var DemoHandler = function () {
        this.onopen = function (event, ws) {
            alert('hello 连上了哦')
           
        }
        /**
         * 收到服务器发来的消息
         * @param {*} event
         * @param {*} ws
         */
        this.onmessage = function (event, ws) {
            /***写你的逻辑**/
            var data = $.parseJSON(event.data);//websocket数据
           

        }

        this.onclose = function (e, ws) {
            console.log("连接关闭...ivaeId="+ivaeId);
            ws.close(e);
        }

        this.onerror = function (e, ws) {
            // error(e, ws)
            console.log("socket异常：连接关闭...ivaeId="+ivaeId);
            ws.close(e);
        }

        /**
         * 发送心跳，本框架会自动定时调用该方法，请在该方法中发送心跳
         * @param {*} ws
         */
        this.ping = function (ws) {
            console.log("ping========="+ivaeId);
            // log("发心跳了")
            ws.send(ivaeId);
        }
    }
})


</script>

</html>
